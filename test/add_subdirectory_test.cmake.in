cmake_minimum_required(VERSION 3.12...3.31)

project(
    ptlibzippy_find_package_test
    LANGUAGES C
    VERSION @PTlibzippy_VERSION@)

enable_testing()
option(PTLIBZIPPY_BUILD_TESTING "" OFF)
option(PTLIBZIPPY_BUILD_SHARED "" @PTLIBZIPPY_BUILD_SHARED@)
option(PTLIBZIPPY_BUILD_STATIC "" @PTLIBZIPPY_BUILD_STATIC@)

add_subdirectory(@PTlibzippy_SOURCE_DIR@ ${CMAKE_CURRENT_BINARY_DIR}/ptlibzippy)

if(PTLIBZIPPY_BUILD_SHARED)
    add_executable(test_example @PTlibzippy_SOURCE_DIR@/test/example.c)
    target_link_libraries(test_example PTlibzippy::PTlibzippy)

    if(NOT ${CMAKE_SHARED_LIBRARY_SUFFIX} STREQUAL ".dll")
        add_test(NAME ptlibzippy_test_example_shared COMMAND test_example)
    endif(NOT ${CMAKE_SHARED_LIBRARY_SUFFIX} STREQUAL ".dll")
endif(PTLIBZIPPY_BUILD_SHARED)

if(PTLIBZIPPY_BUILD_STATIC)
    add_executable(test_example_static @PTlibzippy_SOURCE_DIR@/test/example.c)
    target_link_libraries(test_example_static PTlibzippy::PTlibzippyStatic)
    add_test(NAME ptlibzippy_test_example_static COMMAND test_example_static)
endif(@PTLIBZIPPY_BUILD_STATIC)
