{% extends 'admin/dashboard/index.html.twig' %}

{% block title %}License Key Generator{% endblock %}

{% block body %}
<div class="py-5">
    <div class="admin-header">
        <h1>Admin Panel <span class="admin-breadcrumb">/ Security Tools / Key Generator</span></h1>
        <a href="{{ path('app_admin_dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
    </div>

    <div class="card mt-4 p-4" style="max-width: 800px;">
        <h2 style="color: #FF9800; border-bottom: 2px solid #FF9800; padding-bottom: 10px;">
            <i class="fas fa-key"></i> Key Generator Center
        </h2>
        <p class="text-secondary mt-3">
            Use this tool to generate OFFICIAL signed license keys for your SaaS customers and on-premise installations. 
            Because you hold the RSA Private Key on this infrastructure, only you can generate these codes. 
        </p>

        {% if error %}
            <div class="alert alert-danger">{{ error }}</div>
        {% endif %}

        {% if generated_key %}
            <div class="alert alert-success mt-4">
                <h4><i class="fas fa-check"></i> Key Successfully Generated!</h4>
                <p>Copy the text below and instruct the user to save it as <code>LICENSE_KEY</code> in their root directory.</p>
                <textarea class="form-control mt-2" style="font-family: monospace; font-size: 0.85rem;" rows="6" readonly onclick="this.select()">{{ generated_key }}</textarea>
                <div class="mt-3">
                    <button class="btn btn-primary" onclick="navigator.clipboard.writeText('{{ generated_key }}'); alert('Copied!')">
                        <i class="fas fa-copy"></i> Copy to Clipboard
                    </button>
                    <a href="{{ path('app_admin_license_keys') }}" class="btn btn-secondary ml-2">Generate Another</a>
                </div>
            </div>
        {% else %}
            <form method="post" action="{{ path('app_admin_license_keys') }}" class="mt-4">
                
                <div class="form-group mb-3">
                    <label>License Type</label>
                    <select name="type" class="form-control" required style="max-width: 300px;">
                        <option value="PRO">PRO Edition</option>
                        <option value="ENTERPRISE">ENTERPRISE Edition</option>
                        <option value="SAAS">CLOUD / SAAS Node</option>
                        <option value="TRIAL">TRIAL (30 Days)</option>
                    </select>
                </div>

                <div class="form-group mb-3">
                    <label>Validity Year</label>
                    <input type="number" name="year" class="form-control" value="{{ "now"|date("Y") }}" required style="max-width: 150px;">
                </div>

                <div class="form-group mb-3">
                    <label>Tier / Node Identifier</label>
                    <input type="text" name="tier" class="form-control" placeholder="e.g. OFFICIAL, NODE-01, CUSTOMER-ABC" required style="max-width: 300px;">
                    <small class="form-text text-muted">A unique identifier for where this key will be used.</small>
                </div>

                <div class="form-group mb-4">
                    <label>Target Server Domain</label>
                    <input type="text" name="domain" class="form-control" placeholder="e.g. projecttick.org or mycompany.com" required style="max-width: 300px;">
                    <small class="form-text text-muted">The license will ONLY work if the software is hosted on this domain. Enter 'localhost' for development.</small>
                </div>

                <button type="submit" class="btn btn-primary" style="background: #FF9800; border: none; padding: 10px 24px;">
                    <i class="fas fa-lock"></i> Generate Signed Key
                </button>
            </form>
        {% endif %}
    </div>

    <div class="card mt-4 p-4" style="max-width: 800px;">
        <h3>Current Master Server License Status</h3>
        <ul style="list-style: none; padding-left: 0; font-family: monospace; font-size: 0.9rem; background: #f5f5f5; padding: 15px; border-radius: 6px;">
            <li><strong style="color: #555;">Status:</strong> <span style="color: {{ current_info.status == 'VERIFIED' ? 'green' : 'red' }}">{{ current_info.status }}</span></li>
            <li><strong style="color: #555;">Payload:</strong> {{ current_info.payload ?? 'N/A' }}</li>
            <li><strong style="color: #555;">Type:</strong> {{ current_info.type ?? 'N/A' }}</li>
            <li><strong style="color: #555;">Tier:</strong> {{ current_info.tier ?? 'N/A' }}</li>
            <li><strong style="color: #555;">Domain Locked To:</strong> {{ current_info.domain ?? 'UNRESTRICTED' }}</li>
        </ul>
    </div>
</div>
{% endblock %}
