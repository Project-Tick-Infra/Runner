{% extends 'base.html.twig' %}

{% block title %}Commit History | Project Tick{% endblock %}

{% block body %}
<div class="py-5" style="max-width: 1200px; margin: 0 auto; padding: 0 20px;">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 40px;">
        <div>
            <h1 style="font-family: var(--font-display); font-weight: 900;">Commit <span style="color:#EE0000">History</span></h1>
            <p style="color: var(--text-secondary);">Comprehensive log of all synced repository commits.</p>
        </div>
        <a href="{{ path('app_admin_bot_index') }}" class="btn btn-secondary" style="background: transparent; border: 1px solid #eee; padding: 10px 20px; border-radius: 10px; text-decoration: none; color: #666;">&larr; Back to Hub</a>
    </div>

    <div style="background: white; border-radius: 20px; border: 1px solid #eee; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.02);">
        <form method="GET" action="{{ path('app_admin_bot_commits') }}" style="display: flex; gap: 15px; align-items: flex-end;">
            <div style="flex: 1;">
                <label style="display: block; font-size: 0.75rem; font-weight: 800; color: #999; text-transform: uppercase; margin-bottom: 8px;">Search Query</label>
                <input type="text" name="q" value="{{ search }}" placeholder="SHA, Message or Author..." style="width: 100%; padding: 10px 15px; border-radius: 10px; border: 1px solid #eee; outline: none; font-weight: 500;">
            </div>
            <div style="flex: 1;">
                <label style="display: block; font-size: 0.75rem; font-weight: 800; color: #999; text-transform: uppercase; margin-bottom: 8px;">Repository Filter</label>
                <select name="repo" style="width: 100%; padding: 10px 15px; border-radius: 10px; border: 1px solid #eee; outline: none; font-weight: 500; appearance: none; background: white;">
                    <option value="">All Repositories</option>
                    {% for repo in repos %}
                        <option value="{{ repo }}" {% if repo_filter == repo %}selected{% endif %}>{{ repo }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" style="background: var(--pt-red); color: white; border: none; padding: 11px 25px; border-radius: 10px; font-weight: 800; cursor: pointer;">FILTER</button>
            {% if search or repo_filter %}
                <a href="{{ path('app_admin_bot_commits') }}" style="padding: 11px 20px; color: #999; text-decoration: none; font-weight: 800; font-size: 0.9rem;">CLEAR</a>
            {% endif %}
        </form>
    </div>

    <div style="background: white; border-radius: 20px; border: 1px solid #eee; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.02);">
        <table style="width: 100%; border-collapse: collapse; text-align: left;">
            <thead>
                <tr style="background: #fafafa; border-bottom: 1px solid #eee;">
                    <th style="padding: 20px; font-weight: 800; color: #999; text-transform: uppercase; font-size: 0.75rem;">SHA</th>
                    <th style="padding: 20px; font-weight: 800; color: #999; text-transform: uppercase; font-size: 0.75rem;">Message</th>
                    <th style="padding: 20px; font-weight: 800; color: #999; text-transform: uppercase; font-size: 0.75rem;">Author</th>
                    <th style="padding: 20px; font-weight: 800; color: #999; text-transform: uppercase; font-size: 0.75rem;">Date</th>
                    <th style="padding: 20px; font-weight: 800; color: #999; text-transform: uppercase; font-size: 0.75rem;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for commit in commits %}
                <tr style="border-bottom: 1px solid #f5f5f5;">
                    <td style="padding: 15px 20px;">
                        <code style="font-size: 0.8rem; color: var(--pt-red); background: #fff5f5; padding: 4px 8px; border-radius: 4px; border: 1px solid #ffecec;">
                            {{ commit.sha|slice(0, 7) }}
                        </code>
                    </td>
                    <td style="padding: 15px 20px;">
                        <div style="font-weight: 600; color: #333; margin-bottom: 4px;">{{ commit.message|split('\n')|first }}</div>
                        <div style="font-size: 0.75rem; color: #999;">{{ commit.repository }}</div>
                    </td>
                    <td style="padding: 15px 20px; font-weight: 500;">{{ commit.author }}</td>
                    <td style="padding: 15px 20px; color: #999; font-size: 0.85rem;">{{ commit.date|date('Y-m-d H:i') }}</td>
                    <td style="padding: 15px 20px;">
                        <a href="{{ path('app_admin_bot_commit_detail', {sha: commit.sha, repo: commit.repository}) }}" style="background: white; border: 1px solid #ddd; padding: 6px 12px; border-radius: 6px; font-size: 0.7rem; font-weight: 800; text-decoration: none; color: #666; transition: all 0.2s;" onmouseover="this.style.background='#f9f9f9'" onmouseout="this.style.background='white'">DIFF</a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" style="padding: 50px; text-align: center; color: #999;">No commits found matching your criteria.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if total_pages > 1 %}
    <div style="margin-top: 30px; display: flex; justify-content: center; gap: 10px; align-items: center;">
        {% if current_page > 1 %}
            <a href="{{ path('app_admin_bot_commits', {page: current_page - 1, q: search, repo: repo_filter}) }}" style="padding: 8px 15px; border: 1px solid #eee; border-radius: 8px; text-decoration: none; color: #666; font-weight: 600;">Previous</a>
        {% endif %}
        
        <span style="color: #999; font-size: 0.9rem; font-weight: 600;">Page {{ current_page }} of {{ total_pages }} ({{ total_commits }} total)</span>

        {% if current_page < total_pages %}
            <a href="{{ path('app_admin_bot_commits', {page: current_page + 1, q: search, repo: repo_filter}) }}" style="padding: 8px 15px; border: 1px solid #eee; border-radius: 8px; text-decoration: none; color: #666; font-weight: 600;">Next</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
