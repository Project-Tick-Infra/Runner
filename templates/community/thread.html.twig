{% extends 'base.html.twig' %}

{% block title %}{{ thread.title }} - {{ thread.category.name }}{% endblock %}

{% block body %}
<div class="py-5" style="background: var(--pt-white);">
    <div class="container">
        <nav style="font-size: 0.85rem; color: var(--pt-gray-600); margin-bottom: 20px;">
            <a href="{{ path('app_community') }}" style="color: inherit; text-decoration: none;">Community</a> / 
            <a href="{{ path('app_community_category', {id: thread.category.id}) }}" style="color: inherit; text-decoration: none;">{{ thread.category.name }}</a> / 
            Discussion
        </nav>

        <div class="thread-main" style="margin-bottom: 48px;">
            <div class="card" style="padding: 40px; border-left: 6px solid var(--pt-red); border-radius: 8px;">
                <h1 style="margin-top: 0; margin-bottom: 24px;">{{ thread.title }}</h1>
                
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 32px; padding-bottom: 16px; border-bottom: 1px solid var(--pt-gray-200);">
                    <div style="width: 48px; height: 48px; background: #eee; border-radius: 50%; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                        <img src="https://www.gravatar.com/avatar/{{ thread.author.email|trim|lower|md5 }}?s=48&d=mp" alt="{{ thread.author.username }}">
                    </div>
                    <div>
                        <div style="font-weight: 700; color: var(--pt-black);">{{ thread.author.username ?: thread.author.githubUsername }}</div>
                        <div style="font-size: 0.8rem; color: var(--pt-gray-500);">Posted on {{ thread.createdAt|date('F d, Y @ H:i') }}</div>
                    </div>
                </div>

                <div class="prose" style="line-height: 1.8; color: var(--pt-black); font-size: 1.1rem;">
                    {{ thread.content|nl2br }}
                </div>
            </div>
        </div>

        <div class="comments-section">
            <h2 style="font-size: 1.5rem; margin-bottom: 24px;">{{ thread.comments|length }} Comments</h2>

            {% for comment in thread.comments %}
                <div class="card mb-4" style="padding: 24px; border-radius: 8px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <div style="width: 32px; height: 32px; background: #eee; border-radius: 50%; overflow: hidden;">
                            <img src="https://www.gravatar.com/avatar/{{ comment.author.email|trim|lower|md5 }}?s=32&d=mp" alt="">
                        </div>
                        <div style="font-size: 0.9rem;">
                            <strong>{{ comment.author.username ?: comment.author.githubUsername }}</strong>
                            <span style="color: var(--pt-gray-500); margin-left: 8px;">{{ comment.createdAt|date('M d, Y @ H:i') }}</span>
                        </div>
                    </div>
                    <div style="color: var(--text-primary); line-height: 1.6;">
                        {{ comment.content|nl2br }}
                    </div>
                </div>
            {% endfor %}

            {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                <div class="card" style="padding: 32px; background: var(--pt-gray-100); border: none; border-radius: 8px;">
                    <h3 style="margin-top: 0; margin-bottom: 16px; font-size: 1.25rem;">Add a comment</h3>
                    <form action="{{ path('app_community_comment_new', {id: thread.id}) }}" method="POST">
                        <div class="form-group mb-4">
                            <textarea name="content" rows="5" class="form-control" placeholder="Share your thoughts..." required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" style="padding: 12px 32px; border-radius: 4px;">Post Comment</button>
                    </form>
                </div>
            {% else %}
                <div style="text-align: center; padding: 40px; border: 2px dashed var(--pt-gray-200); border-radius: 8px;">
                    <p style="margin: 0; color: var(--pt-gray-500);">Please <a href="{{ path('app_login') }}" style="font-weight: bold; color: var(--pt-red);">Log In</a> to participate in this discussion.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
